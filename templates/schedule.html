<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schedule - AyurSutra</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* ---------- RESET ---------- */
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Nunito Sans', sans-serif;
  background: linear-gradient(135deg, #eef2ff 0%, #f9fbff 40%, #e6f7ff 100%);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* ---------- HEADER ---------- */
header {
  width:100%;
  background: linear-gradient(90deg, #6A11CB, #2575FC);
  color:#ffffff;
  text-align:center;
  padding:35px 20px;
  font-size:30px;
  font-weight:700;
  border-bottom-left-radius:30px;
  border-bottom-right-radius:30px;
  box-shadow:0 4px 15px rgba(0,0,0,0.25);
  position: relative;
}
header .logout-btn {
  position:absolute;
  right:25px; top:25px;
  background:#c62828;
  color:#ffffff;
  border:none;
  padding:12px 22px;
  border-radius:25px;
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
  text-decoration:none;
}
header .logout-btn:hover { background:#b71c1c; }

/* ---------- NAVBAR ---------- */
.navbar {
  display:flex;
  justify-content:center;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(10px);
  padding:15px 0;
  box-shadow:0 3px 15px rgba(0,0,0,0.08);
  border-radius:0 0 20px 20px;
  position:sticky;
  top:0;
  z-index:10;
}
.navbar a {
  text-decoration:none;
  color:#6A11CB;
  font-family:'Poppins',sans-serif;
  font-weight:600;
  margin:0 25px;
  font-size:16px;
  transition:0.3s;
}
.navbar a:hover {
  color:#2575FC;
  border-bottom:3px solid #2575FC;
  padding-bottom:3px;
}

/* ---------- MAIN CONTENT ---------- */
.main-content {
  max-width:1200px;
  margin:50px auto;
  padding:0 25px;
  flex:1;
}

/* ---------- SUMMARY CARDS ---------- */
.summary {
  display:flex;
  flex-wrap:wrap;
  gap:25px;
  margin-bottom:40px;
}
.summary-card {
  flex:1;
  min-width:160px;
  background:white;
  padding:25px;
  border-radius:20px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.07);
  transition:all 0.3s;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-weight:600;
  color:#2575FC;
}
.summary-card i {
  font-size:28px;
  margin-bottom:12px;
}
.summary-card:hover {
  transform: translateY(-5px);
  box-shadow:0 15px 35px rgba(0,0,0,0.1);
}

/* ---------- TABLE ---------- */
table {
  width:100%;
  border-collapse:collapse;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 10px 25px rgba(0,0,0,0.07);
  background:white;
}
th, td {
  padding:14px 18px;
  text-align:left;
}
th {
  background:#6A11CB;
  color:#ffffff;
  font-weight:600;
}
tr:nth-child(even){ background:#f1f3ff; }
tr:hover{ background:#e0e7ff; transition:0.3s; }

/* ---------- STATUS BADGES ---------- */
.status-badge {
  padding:6px 14px;
  border-radius:15px;
  font-weight:600;
  font-size:13px;
  display:inline-block;
  color:white;
}
.status-upcoming { background:#ff9800; }
.status-completed { background:#4caf50; }
.status-canceled { background:#f44336; }
.status-missed { background:#f57c00; }

/* ---------- BUTTONS ---------- */
button.cancel-btn, button.mark-btn {
  border:none;
  padding:8px 14px;
  border-radius:50px;
  cursor:pointer;
  font-size:13px;
  margin:2px;
  font-weight:600;
  transition:0.3s;
}
button.cancel-btn { background:#c62828; color:white; }
button.cancel-btn:hover { background:#b71c1c; }
button.mark-completed { background:#4caf50; color:white; }
button.mark-completed:hover { background:#388e3c; }
button.mark-missed { background:#f57c00; color:white; }
button.mark-missed:hover { background:#ef6c00; }

/* ---------- BACK LINK ---------- */
.back-link {
  display:inline-block;
  margin-top:25px;
  text-decoration:none;
  color:#2575FC;
  font-weight:600;
  transition:0.3s;
}
.back-link:hover { color:#6A11CB; text-decoration:underline; }

/* ---------- RESPONSIVE ---------- */
@media (max-width:768px){
  .summary-card { min-width:140px; font-size:14px; }
  th, td { padding:10px; font-size:13px; }
}
</style>
</head>
<body>

<header>Schedule
  <a class="logout-btn" href="{{ url_for('logout') }}">Logout</a>
</header>

<nav class="navbar">
  <a href="{{ url_for(session['role'] + '_dashboard') }}">Dashboard</a>
  <a href="{{ url_for('schedule') }}">Schedule</a>
  <a href="{{ url_for('messages') }}">Messages</a>
  <a href="{{ url_for('reports') }}">Reports</a>
</nav>

<div class="main-content">

  <!-- Summary Cards -->
  <div class="summary">
    <div class="summary-card"><i>üìÖ</i> Total Sessions: {{ total_sessions }}</div>
    <div class="summary-card"><i>‚è≥</i> Upcoming: {{ upcoming_sessions }}</div>
    <div class="summary-card"><i>‚úÖ</i> Completed: {{ completed_sessions }}</div>
    <div class="summary-card"><i>‚ùå</i> Canceled: {{ canceled_sessions }}</div>
    <div class="summary-card"><i>‚ö†Ô∏è</i> Missed: {{ missed_sessions }}</div>
  </div>

  <!-- Schedule Table -->
  {% if bookings %}
  <table>
    <thead>
      <tr>
        <th>Therapist</th>
        <th>Patient</th>
        <th>Start Time</th>
        <th>Status</th>
        <th>Notes</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for b in bookings %}
      <tr>
        <td>{{ b.therapist.username if b.therapist else "-" }}</td>
        <td>{{ b.patient.username if b.patient else "-" }}</td>
        <td>{{ b.start_time.strftime("%Y-%m-%d %H:%M") }}</td>
        <td>
          {% if b.status == "Upcoming" %}
            <span class="status-badge status-upcoming">Upcoming</span>
          {% elif b.status == "Completed" %}
            <span class="status-badge status-completed">Completed</span>
          {% elif b.status == "Canceled" %}
            <span class="status-badge status-canceled">Canceled</span>
          {% elif b.status == "Missed" %}
            <span class="status-badge status-missed">Missed</span>
          {% else %}
            {{ b.status }}
          {% endif %}
        </td>
        <td>{{ b.notes or "-" }}</td>
        <td>
          {% if b.status == "Upcoming" %}
          <form method="POST" style="display:inline;">
            <input type="hidden" name="cancel_booking_id" value="{{ b.id }}">
            <button type="submit" class="cancel-btn">Cancel</button>
          </form>
          <form method="POST" action="{{ url_for('update_booking_status', booking_id=b.id, new_status='Completed') }}" style="display:inline;">
            <button type="submit" class="mark-btn mark-completed">Mark Completed</button>
          </form>
          <form method="POST" action="{{ url_for('update_booking_status', booking_id=b.id, new_status='Missed') }}" style="display:inline;">
            <button type="submit" class="mark-btn mark-missed">Mark Missed</button>
          </form>
          {% else %}-{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="text-align:center; margin-top:20px;">No sessions found.</p>
  {% endif %}

  <a href="{{ url_for(session['role'] + '_dashboard') }}" class="back-link">Back to Dashboard</a>
</div>

</body>
</html>
